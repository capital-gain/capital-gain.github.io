{%- comment -%}
Кастомная генерация SEO title с поддержкой автоматического title из контента
для постов без заголовка
{%- endcomment -%}

{%- assign seo_title = "" -%}

{%- if paginator.page and paginator.page > 1 -%}
  {%- assign seo_title = "Страница " | append: paginator.page -%}
{%- elsif page.title and page.title != "" -%}
  {%- assign seo_title = page.title | smartify -%}
{%- else -%}
  {%- comment -%}Генерируем title из первых 6 слов контента{%- endcomment -%}
  {%- assign content_text = page.content | strip_html | strip_newlines | normalize_whitespace | strip -%}
  {%- assign words = content_text | split: " " -%}
  {%- assign first_words = "" -%}
  {%- assign word_count = 0 -%}
  {%- for word in words -%}
    {%- assign clean_word = word | strip -%}
    {%- if clean_word != "" and word_count < 6 -%}
      {%- if first_words == "" -%}
        {%- assign first_words = clean_word -%}
      {%- else -%}
        {%- assign first_words = first_words | append: " " | append: clean_word -%}
      {%- endif -%}
      {%- assign word_count = word_count | plus: 1 -%}
    {%- endif -%}
  {%- endfor -%}
  {%- if first_words != "" -%}
    {%- assign seo_title = first_words | append: "…" | smartify -%}
  {%- endif -%}
{%- endif -%}

{%- if seo_title != "" -%}
  {%- if paginator.page and paginator.page > 1 -%}
    {%- assign formatted_title = seo_title | append: " | " | append: site.title | append: " | " | append: site.tagline -%}
  {%- else -%}
    {%- assign formatted_title = seo_title | append: " | " | append: site.title -%}
  {%- endif -%}
{%- else -%}
  {%- assign formatted_title = site.title | append: " | " | append: site.tagline -%}
{%- endif -%}

<title>{{ formatted_title }}</title>

{%- comment -%}Остальные SEO теги генерируем стандартным способом{%- endcomment -%}
{%- seo title=false -%}
