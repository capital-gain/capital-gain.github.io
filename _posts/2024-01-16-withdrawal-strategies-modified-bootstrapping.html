---
layout: post
status: publish
published: true
title: 'Жизнь с капитала: модифицированный бутстрапинг данных российского рынка'
excerpt:
  Марк Твен однажды сказал, что история не повторяется, но рифмуется. Так,
  наверно, думали и те, кто впервые придумал использовать метод бутстрапинга для анализа
  финансовых данных, которых всегда недостаточно. С помощью этого метода я «размножил»
  прошлые данные за имеющиеся 20+ лет и посмотрел, чем заканчивались 30-ти и 50-летние
  пенсии с портфелем, включащем в себя только активы, доступные внутри России.
wordpress_id: 17309
date: '2024-01-16 11:35:29 +0600'
categories:
  - Авторские тексты
tags:
  - Пенсия
  - Риск
  - Инвестирование
  - Планирование
comments:
  - id: 8699
    author: Андрей Трофимов
    author_email: trofimov-andruha@mail.ru
    author_url: ''
    date: '2024-01-16 16:44:52 +0600'
    date_gmt: '2024-01-16 13:44:52 +0600'
    content:
      "По-доброму завидую вашим аналитическим способностям и ясности ума. Сайт
      уже содержит такое кол-во аналитической информации в контексте инвестиций внутри
      РФ (и для её граждан), и концентрация её зашкаливает, что, по моему мнению, сопоставимо
      со всем остальным объемом материалов подобного содержания в русскоязычном сегменте
      интернета. \nВидно, что стараетесь доносить результаты своей деятельности для
      широкой аудитории - простым языком, зачастую опуская \"формульную\" (математическую)
      составляющую, но даже так не скрыть глубину погружения в специфику инвестиционной
      исследовательской работы.\nБраво! Продолжайте в том же духе. И, пожалуйста, не
      сочтите за лесть:)"
  - id: 8700
    author: Дмитрий Никитенко
    author_email: dima.nikitenko@gmail.com
    author_url: https://capital-gain.ru
    date: '2024-01-16 16:57:03 +0600'
    date_gmt: '2024-01-16 13:57:03 +0600'
    content: Большое спасибо! :)
---

<p>
  Что вообще за бутстрапинг такой? Помните &laquo;Приключения барона
  Мюнхгаузена&raquo;, в которых, кроме прочего, он вытаскивал себя из болота за
  волосы? У американцев есть похожий прикол, только тянуть предлагается за петли
  на задниках ботинок — bootstraps. Такая
  <a href="https://en.wiktionary.org/wiki/pull_oneself_up_by_one%27s_bootstraps"
    >идиома</a
  >
  в языке на случай, если надо указать на невыполнимость задачи.
</p>

<figure>
  <figure>
    <img src="/assets/images/munchausen.jpg" alt="" />
  </figure>

  <figure>
    <img src="/assets/images/bootstraps.jpg" alt="" />
  </figure>
</figure>

<p>
  Наверно, в качестве иронии относительно его недостатков, но метод<strong>
    бутстрапинга</strong
  >
  вошел и в науку и используется во многих областях. В общем смысле так называют
  любой самозапускающийся процесс, который должен продолжаться или развиваться
  без помощи извне.
</p>

<p>
  В статистике бутстрапингом называют метод, когда при недостаточности
  исторических данных для того, чтобы сделать из них далеко идущие выводы, мы
  пытаемся искусственно их продолжить, по возможности сохраняя свойства
  исходного распределения вероятностей. В отличие от Монте-Карло симуляции для
  получения случайных значений здесь используются не одно из известных
  статистических распределений с параметрами, а сами эмпирические значения
  (прошлые данные). Хотя и МКС бывают разные, и бутстрапинг при желании можно
  назвать разновидностью МКС.
</p>

<p>
  Применительно к финансовым активам, обычным бутстрапингом будет создание новой
  выборки путем отбора отдельных доходностей из реальной выборки (действительно
  случившихся в прошлом доходностей, которые у нас есть) в случайном порядке.
  Использование именно прошлых доходностей позволяет нам сохранить некоторые
  свойства оригинального распределения — среднюю
  <em>арифметическую</em> доходность и волатильность, потому что мы лишь
  перемешиваем в случайном порядке те же самые доходности.
</p>

<p>
  Если бы доходности рождались в полной независимости друг от друга, этого было
  бы вполне достаточно. Но в реальных рядах доходностей существует такая вещь
  как автокорреляция, когда следующие доходности в какой-то степени и в рамках
  каких-то периодов зависят от предыдущих (моментум, возврат к среднему). Кроме
  того, существуют разные классы активов, имеющие свойственные им корреляции
  между собой, а также с инфляцией или ключевой ставкой.
</p>

<p>
  В таком случае, просто выбирая случайные прошлые доходности, мы сохраняем лишь
  некоторые свойства распределения доходностей, а иные теряем, а также теряем
  корреляции между классами активов. Полностью победить это практически
  невозможно — нам не настолько хорошо известны величины и тайминг этих явлений,
  чтобы их было легко смоделировать.
</p>

<p>
  Чтобы решить эту проблему частично, вместо простого бутстрапинга с выбором
  одной прошлой доходности можно выбирать случайные суб-ряды или
  <strong>блоки</strong> прошлых доходностей за произвольно определенные
  интервалы внутри полного периода, что позволит сохранить хотя бы часть той
  магии вуду, что происходит на финансовых рынках, в полученных на выходе
  случайных данных. Это и называют <strong>modified bootstrapping</strong> или
  <strong>block sampling</strong>.
</p>

<p>
  Если речь идет о портфеле из нескольких классов активов, логичным будет
  сделать этот процесс единым для всех рядов данных, участвующих в портфеле. Для
  этого первым делом выбирать нужно не данные, а даты — из общего доступного для
  всего портфеля периода. Например, блоками длиной в 5 лет. И по этим датам
  начала и конца случайного блока уже выбирать данные из разных рядов,
  участвующих в портфеле. Тогда сохранятся корреляции между активами в портфеле,
  активов и инфляции, а также их общая реакция на какие-то внешние факторы и
  шоки, свойственные конкретному времени. Иными словами, перемешиваем не
  доходности, а время. Как это называют я не знаю, придумал сам специально для
  этой статьи, но, должно быть, так делают все.
</p>

<h2>Данные</h2>

<p>
  В
  <a href="https://capital-gain.ru/posts/withdrawal-strategy-russian-flavour/"
    >первой</a
  >
  статье я использовал короткий 20-летний период с 2003 года, во
  <a href="https://capital-gain.ru/posts/withdrawal-strategies-comparison/"
    >второй</a
  >
  расширил его до 1998-го, а теперь с помощью описанных пермутаций попробую из
  имеющихся исторических данных получить 200 лет рифмующейся истории для анализа
  безопасных ставок изъятий на российском рынке, что позволит нам, наконец, хоть
  и вытягивая себя за волосы, посмотреть что может быть с российскими
  пенсионерами, если выводить из портфеля деньги не по 15 лет подряд, а по 30
  лет и больше, как это делается в зарубежных исследованиях.
</p>

<p>
  В качестве реальных данных, из которых будет осуществляться случайная выборка,
  я решил взять период истории с 2003 года, а не имеющийся у меня более полный с
  1998-го, потому что в 90-х годах происходили такие аномалии, особенно с
  облигациями и инфляцией, что повторять их в бутстрапе было бы странно. Будем
  считать, что ~1900% доходности, полученные одним из ОПИФ облигаций в 1999
  году, бывают только раз в жизни.
</p>

<p>
  Вот, что у меня получилось сгенерировать за 200 лет по различным активам на
  российском рынке и инфляции, случайно выбирая блоки по 5 лет из имеющихся
  исторических данных:
</p>

<figure>
  <a href="/assets/images/bootstrap-200y-sample.png"
    ><img src="/assets/images/bootstrap-200y-sample.png" alt=""
  /></a>
</figure>

<p>
  Как видите, недостатком метода является то, что прошлые тенденции
  экстраполируются в будущее. И, если с тем, что акции в будущем будут приность
  больше доходности, чем облигации, легко согласиться, то насчет того, что
  депозиты будут обгонять инфляцию, а золото — акции, можно поспорить. Особенно
  необычно здесь смотрится как раз золото, но на имеющихся исторических данных
  его доходность
  <a href="/assets/images/wd-data.png" target="_blank" rel="noreferrer noopener"
    >была</a
  >
  на уровне акций, так что придется с этим смириться.
</p>

<figure>
  <table>
    <thead>
      <tr>
        <th>Актив</th>
        <th>CAGR, %/г<br />(реальная)</th>
        <th>СКО, %/г<br />(реальное)</th>
        <th>CAGR, %/г<br />(бутстрап)</th>
        <th>СКО, %/г<br />(бутстрап)</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Инфляция</td>
        <td>8,4</td>
        <td>2,5</td>
        <td>7,9</td>
        <td>2,3</td>
      </tr>
      <tr>
        <td>Акции (MCFTR)</td>
        <td>15,9</td>
        <td>25,2</td>
        <td>12,4</td>
        <td>24,4</td>
      </tr>
      <tr>
        <td>Облигации (RGBITR)</td>
        <td>9,1</td>
        <td>7,9</td>
        <td>9,4</td>
        <td>7,4</td>
      </tr>
      <tr>
        <td>Золото</td>
        <td>14,4</td>
        <td>23,5</td>
        <td>14,5</td>
        <td>23,8</td>
      </tr>
      <tr>
        <td>Депозиты</td>
        <td>8,9</td>
        <td>0,6</td>
        <td>9,0</td>
        <td>0,6</td>
      </tr>
    </tbody>
  </table>
  <figcaption>
    Номинальные доходности и волатильность реальных исторических и
    сгенерированных рядов по активам.
  </figcaption>
</figure>

<p>
  Средняя геометрическая доходность акций сгенерировалась ниже, чем в прошлых
  данных — за вычетом инфляции всего 4,17%/г против 6,92%/г. Средняя
  арифметическая доходность (нет в таблице) при этом составила 15,9%/г, тогда
  как в реальных данных она была 19,8%/г. На графике видно, что рост акций
  замедляется где-то во второй его половине.
</p>

<p>
  Почему так получилось? Может быть, просто случайность, потому что 40
  пятилетних блоков недостаточно, чтобы средние значения выборки сравнялись с
  эмпирическими? Нет. Я пробовал генерировать данные за 5000 лет с разным
  размером блока (1, 3, 5, 10 лет) — CAGR акций всегда получается ниже, чем в
  реальных прошлых данных, в среднем около 12,5%/г &plusmn; 1 п. п. в
  зависимости от размера блока.
</p>

<p>
  Если тот же опыт проделать с историей S&amp;P 500 с 1871 года, то бутстрапинг
  в любом его виде сохраняет средние доходности на том же уровне, что у реальной
  выборки. Видимо, внутри этого короткого периода истории, что доступен по
  российскому рынку, встречается больше субрядов с более низкой средней
  доходностью, чем у реального ряда, но выстроились они удачным образом, что при
  удлинении выборки с перемешиванием уже не происходит. В итоге я решил
  использовать изначально полученные данные, статистика которых приведена выше.
  Можно считать их консервативными.
</p>

<p>
  Напомню, что случайно я получал только границы 5-летних блоков, а сами данные
  из имеющихся исторических рядов по разным активам выбирались за один и тот же
  период, чтобы сохранить корреляции активов между собой:
</p>

<figure>
  <a href="/assets/images/SCR-20240112-bootstrap-200y.png"
    ><img
      src="/assets/images/SCR-20240112-bootstrap-200y.png"
      alt=""
      style="width: 400px"
  /></a>
  <figcaption>
    Корреляции Спирмена получились очень похожими на реальные.<br />Корреляции
    по историческим данным можно посмотреть
    <a
      href="/assets/images/wd-monthly-data-correlation.png"
      target="_blank"
      rel="noreferrer noopener"
      >здесь</a
    >.
  </figcaption>
</figure>

<p>
  Данные об инфляции были получены тем же способом, поэтому доходности активов
  внутри случайных 5-летних периодов соотносятся не только между собой, но и с
  инфляцией за то же время, что особенно важно для проверки стратегий изъятия
  денег из портфеля, многие из которых индексируют выводимые суммы на её размер:
</p>

<figure>
  <a
    href="/assets/images/bootstrap-200y-monthly-inflation.png"
    target="_blank"
    rel="noreferrer noopener"
    ><img src="/assets/images/bootstrap-200y-monthly-inflation.png" alt=""
  /></a>
</figure>

<h2>Результаты</h2>

<p>
  После основательного прогрева моего макбука на уже не новом чипе M1 по всем
  восьми ядрам мне удалось получить следующие результаты на отрезках в 30
  (слева) и 50 лет (справа) по тому же портфелю, что я использовал в прошлых
  статьях — 50% российских акций (MCFTR), 30% российских облигаций (RGBITR), 10%
  депозитов и 10% золота. В таблицах верхнего ряда для определения начальных
  сумм изъятий из портфелей использована ставка 4%, а в нижнем — 3%:
</p>

<figure>
  <figure>
    <a
      href="/assets/images/SCR-20231216-pmr-200-5-30.png"
      target="_blank"
      rel="noopener"
      ><img src="/assets/images/SCR-20231216-pmr-200-5-30-952x1024.png" alt=""
    /></a>
  </figure>

  <figure>
    <a
      href="/assets/images/SCR-20231216-pmr-200-5-50.png"
      target="_blank"
      rel="noopener"
      ><img src="/assets/images/SCR-20231216-pmr-200-5-50-979x1024.png" alt=""
    /></a>
  </figure>

  <figure>
    <a
      href="/assets/images/SCR-20240112-pmr-200-5-30-wr-3.png"
      target="_blank"
      rel="noopener"
      ><img
        src="/assets/images/SCR-20240112-pmr-200-5-30-wr-3-972x1024.png"
        alt=""
    /></a>
  </figure>

  <figure>
    <a
      href="/assets/images/SCR-20240112-pmr-200-5-50-wr-3.png"
      target="_blank"
      rel="noopener"
      ><img
        src="/assets/images/SCR-20240112-pmr-200-5-50-wr-3-1004x1024.png"
        alt=""
    /></a>
  </figure>
  <figcaption>
    Результаты можно сравнить с теми, что были получены на обычных исторических
    данных в
    <a
      href="https://capital-gain.ru/posts/withdrawal-strategies-comparison/#Analiz_rezultatov"
      >одной из прошлых статей</a
    >, но следует помнить, что там срок изъятий из портфелей был установлен в 15
    лет из-за недостаточности данных по российскому фондовому рынку. В остальном
    методика осталась неизменной, для вывода денег из портфеля используются
    &laquo;правила управления портфелем&raquo;, ребалансировка делается
    ежегодно. ПС = покупательная способность. Формулы всех метрик в таблицах
    были описаны в прошлых статьях.
  </figcaption>
</figure>

<p>
  Также я сгенерировал 1000 лет данных с тем же сидом генератора случайных чисел
  и запустил на них тот же код с периодом изъятий 30 лет. На этот раз только по
  двум стратегиям, потому что на все не хватило бы оперативной памяти.
  Результаты за 1000 лет оказались несколько
  <a
    href="/assets/images/SCR-20231216-pmr-1000-5-30.png"
    target="_blank"
    rel="noreferrer noopener"
    >лучше</a
  >, чем на скринах выше, но в целом похожими.
</p>

<p>
  <strong>Важно</strong>: к любым числам в этих таблицах не стоит относится как
  к гарантии. Скорее по ним можно получить общее представление о
  жизнеспособности стратегий или &laquo;жизни с капитала&raquo; в целом как
  идеи. Мы лишь размножили прошлые доходности, которые по-прежнему не
  гарантируют будущих.
</p>

<p>
  Что изменилось теперь, когда у нас есть результаты 30-ти и 50-летних пенсий?
</p>

<ul>
  <li>
    Лучше проявилась разница между стратегиями. Им хватило времени, чтобы
    раскрыться. Например, интересна успешность по критерию &laquo;конечный
    остаток > начального&raquo; в реальном выражении, который показывает как
    хорошо или плохо стратегии сохраняют вложенный капитал. При ставке 4% в
    портфеле остается больше половины капитала после 30 и 50 лет изъятий даже
    несмотря на то, что доходность акций у нас получилась хуже исторической, что
    можно считать очень хорошим результатом.
  </li>

  <li>
    Появились результаты, в которых успешность по критерию &laquo;конечный
    остаток > нуля&raquo; уже не 100%, особенно на периоде в 50 лет — в
    некоторых случаях портфели все-таки не доживают до конца пенсии, но таких
    мало.
  </li>

  <li>
    При ставке 4% денег почти во всех портфелях и стратегиях хватает на весь
    30-летний период пенсии, а вот рассчитывать сохранить реальную стоимость
    капитала можно только в 50–60% случаев.
  </li>

  <li>
    При той же ставке, но на 50-летних периодах, количество портфелей, в которых
    деньги заканчиваются раньше, чем через 50 лет, заметно растет, но только в
    наиболее фиксированных по суммам изъятий стратегиях (SWR, Kitces Ratchet).
    Гибкие стратегии прекрасно доживают до конца периода, но для этого придется
    быть готовым сокращать изъятия — по некоторым стратегиям в 5% худших случаев
    на 40% и больше.
  </li>

  <li>
    Ставка 3% значительно лучше сохраняет капитал. Если ваша цель включает в
    себя сохранение большей части начальной стоимости портфеля, лучше выбирать
    ставку ниже 4%. Снижение изначальной ставки изъятий также позволяет
    значительно снизить риск снижения сумм изъятий в гибких стратегиях в
    будущем.
  </li>

  <li>
    На периодах в 50 лет по большинству стратегий доли портфелей, в которых
    конечный капитал в реальном выражении оказался выше начального, стали
    больше, чем были на 30-летних, несмотря на продолжающийся вывод средств.
    Дело в том, что изначально утратившие значимую часть стоимости, но выжившие
    портфели, со временем восстанавливают свою стоимость и улучшают эту
    статистику. Такой же эффект можно видеть и в Монте-Карло симуляции — с
    началом изъятий средняя стоимость портфелей в выборке падает, но со временем
    плавно восстанавливается. Такое же поведение можно ожидать и в реальности,
    по крайней мере если свойства распределения доходностей со временем не будут
    сильно меняться (если процесс более-менее стохастический).
  </li>

  <li>
    В отличие от результатов на реальных данных (на 15-летних периодах),
    максимумы по капиталу и суммам изъятий кратно уменьшились и стали больше
    похожи на результаты из 95-х процентилей по реальным данным. Я это связываю
    с тем же, что не дало нам получить схожую с исторической доходность акций —
    потерей каких-то эффектов в данных из-за случайного перемешивания. Одно из
    ограничений этого метода.
  </li>

  <li>
    Худшие случаи (меньше медианы) тоже стали хуже, чем были на реальных
    15-летних периодах пенсии, но это уже вполне ожидаемо, потому что у нас
    появилось больше различных сценариев развития событий в выборке. При этом
    между худшими случаями в 30-летних и 50-летних периодах разница небольшая.
  </li>

  <li>
    Самые плохие результаты по сохранению капитала были получены в стратегии
    Kitces Ratchet на 50-летних периодах. Она предусматривает повышение сумм
    вывода денег из портфеля по мере роста его стоимости, но не предусматривает
    обратного снижения, если дела пошли плохо. На коротких данных этого не было
    видно, а на длинных проявился риск таких увеличений расходов без обратного
    механизма.
  </li>

  <li>
    Самыми живучими стратегиями оказались Гайтон-Клингер, &laquo;постоянный
    процент&raquo; и &laquo;правило 95%&raquo;. Вполне ожидаемо, ведь они самые
    гибкие и быстро реагирующие на изменения. При ставке 4% ни в одном из 2040
    30-летних и 1800 50-летних пересекающихся периодов стоимость портфеля и
    сумма вывода не опускалась до нуля (у Vanguard Dynamic Spending успешность
    100% в таблице получилась из-за округления до целого, см. минимум по метрике
    &laquo;сохранение ПС изъятий&raquo;).
  </li>

  <li>
    Интересно себя показала стратегия Уильяма Бенгена Floor &amp; Ceiling — по
    метрикам успешности она несколько уступает более гибким аналогам, зато в
    предложенном автором варианте она не заставляет инвестора снижать расходы
    более, чем на 10%. Если же есть возможность нижнюю планку расходов опускать
    ниже, можно ожидать и лучших результатов по сохранению капитала. При этом
    она ограничивает и увеличение расходов, в варианте по-умолчанию запрещая
    поднимать их выше, чем на 25%. Простейшая стратегия оказалась эффективной и
    удобно настраиваемой под себя.
  </li>
</ul>
