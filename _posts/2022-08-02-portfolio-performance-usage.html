---
layout: post
status: publish
published: true
title: Учет инвестиций в программе Portfolio Performance
excerpt: В прошлом году весь свой учет инвестиций я перенес из таблицы в Google Sheets в программу Portfolio Performance. Учет сделок и все расчеты структуры и результатов портфеля теперь там, а личных финансов в целом (баланс, доходы и расходы, план) остался в таблицах. За время использования программы накопился опыт её настройки, которым и хочу поделиться. В конце будет бонус, так что загляните даже если уже пользуетесь этим софтом.
wordpress_id: 11972
date: '2022-08-02 17:33:37 +0600'
categories:
  - Авторские тексты
tags:
  - Инструменты
  - Учет
  - Личные финансы
comments:
  - id: 3951
    author: Nekto
    author_email: nospam@mailinator.com
    author_url: ''
    date: '2022-08-03 21:35:20 +0600'
    date_gmt: '2022-08-03 18:35:20 +0600'
    content:
      Ура ) хоть что-то на русском. Я когда с ней разбирался смотрел немецкие
      видео с переведенными субтитрами
  - id: 4000
    author: Алексей
    author_email: a.chursanov@gmail.com
    author_url: ''
    date: '2022-08-06 17:33:44 +0600'
    date_gmt: '2022-08-06 14:33:44 +0600'
    content: |-
      Добрый день! Спасибо за рекомендацию.

      Начал с создания активов (акции Мосбиржи). Не могу найти способа копировать уже созданные активы. Приходится каждый раз создавать заново и заполнять все поля. Неужели нет копирования?
  - id: 4002
    author: Дмитрий Никитенко
    author_email: dima.nikitenko@gmail.com
    author_url: https://capital-gain.ru
    date: '2022-08-06 18:06:52 +0600'
    date_gmt: '2022-08-06 15:06:52 +0600'
    content: Да, мне тоже не хватало иногда, но, похоже, копирования нет.
  - id: 4043
    author: KitchenFinance
    author_email: kitchenfinance@mail.ru
    author_url: ''
    date: '2022-08-10 17:04:57 +0600'
    date_gmt: '2022-08-10 14:04:57 +0600'
    content:
      "Если речь идет о копировании актива из одного портфеля в другой, то это
      возможно следующим образом: \n1. В портфеле (файле.xml), куда хотели бы перемещать
      ценную бумагу, создать Watchlist.\n2. Разделить экран PP на два портфеля так,
      чтобы они были видны рядом друг с другом. Это можно делать, таская мышкой портфель
      (название) слегка вниз - PP тогда предлагает разделение экрана. (Потом так же
      можно таскать обратно, чтобы иметь только 1 портфель на весь экран)\n3. Перетаскать
      мышью ценную бумагу в Watchlist. Она также появится среди всех ценнных бумаг портфеля.
      Параметры и история котировок передаются, сделки - нет."
  - id: 4044
    author: Дмитрий Никитенко
    author_email: dima.nikitenko@gmail.com
    author_url: https://capital-gain.ru
    date: '2022-08-10 17:14:07 +0600'
    date_gmt: '2022-08-10 14:14:07 +0600'
    content:
      Жесть)) Спасибо за лайфхак! По-моему это так сложно, что проще настройки
      котировок скопировать в любой текстовый редактор и из него ручками копировать
      в новые активы, всё равно их надо немного править. А больше там вроде и копировать
      особо нечего (названия, тикеры, ISIN у каждого актива свои).
  - id: 5612
    author: Алексей
    author_email: prieffi@gmail.com
    author_url: ''
    date: '2023-03-12 16:19:17 +0600'
    date_gmt: '2023-03-12 13:19:17 +0600'
    content:
      Как заставить программу использовать курс валюты из данных Мосбиржи, а
      не последние данные ЕЦБ на март прошлого года, для отчетов? А то она использует
      курс примерно 110,71 и данные в рублях по долларовым бумагам завышены.
  - id: 5613
    author: Алексей
    author_email: prieffi@gmail.com
    author_url: ''
    date: '2023-03-12 16:35:36 +0600'
    date_gmt: '2023-03-12 13:35:36 +0600'
    content: Разобрался. Сам немного накосячил при создании нового валютного курса )
  - id: 11029
    author: Алексей Сотов
    author_email: xechehot@gmail.com
    author_url: ''
    date: '2024-04-26 12:02:09 +0600'
    date_gmt: '2024-04-26 09:02:09 +0600'
    content: |-
      Спасибо за статью, смотрел на красивые  графики в блоге про Итоги и задавался вопросом - как сделать такое же для своего портфеля.
      У меня вопросы:
      1. Как правильно учитывать stock options? Если от компании в которой я работаю периодически вестятся акции, то как их правильно учитывать в портфеле?
      На форуме пишут, что нужно делать Inbound transfer на соотвествующий Securities аккаунт. Вроде это правильнее, чем оформлять транзакцию, как покупку?
      2. Я продаю акции за X и покупаю другие активы за X. При этом из своего внешнего источника дохода я плачу налоги за продажу акций. Как правильно учитывать налоги в этом случае? Стоит ли их учитывать в портфеле?
  - id: 11030
    author: Дмитрий Никитенко
    author_email: dima.nikitenko@gmail.com
    author_url: https://capital-gain.ru
    date: '2024-04-27 15:15:34 +0600'
    date_gmt: '2024-04-27 12:15:34 +0600'
    content: |-
      <ol>
      <li>Да, то, что досталось бесплатно (ну, как вознаграждение), я бы зачислял напрямую на securities account.</li>
      <li>В общем-то, как хотите. Я хочу видеть чистую доходность <em>инвестиций</em> в статистике этой программы, поэтому учитываю в ней сколько налога заплатил, равно как и комиссии. А вот вычет по ИИС, который ФНС деньгами выплачивает, в PP не учитываю, такое уже отдельно в спредшите с личными финансами.</li>
      </ol>
  - id: 12150
    author: Иван
    author_email: mivang@yandex.ru
    author_url: ''
    date: '2024-08-12 22:56:51 +0600'
    date_gmt: '2024-08-12 19:56:51 +0600'
    content:
      Получилось подгрузить данные Historical Quotes и Latest Quote путем обращения
      к JSON Feed URL API Мосбиржи для Board TQBR и TQPI (Фондовый рынок Т+ Акции и
      ДР и Фондовый рынок Т+ Акции ПИР соответственно), но для Board MTQR (Внебиржевой
      рынок акций с ЦК режим "Непрерывный аукцион с ЦК") возвращает пустые данные по
      обоим URL'ам. Если кто-нибудь добрый подскажет, как починить, был бы благодарен
      )
---

<p>
  <strong>UPD 16.08.2025</strong>. Добавил инструкции по импорту данных о любых
  ПИФ с InvestFunds, iNAV с Мосбиржи и курсов валют с моего сайта, обновил
  инструкцию по импорту поледней цены актива (latest quote) с Мосбиржи.
</p>

<p>
  <a
    rel="noreferrer noopener"
    href="https://www.portfolio-performance.info/en/"
    data-type="URL"
    data-id="https://www.portfolio-performance.info/en/"
    target="_blank"
    >Portfolio Performance</a
  >
  — немецкий open source проект (с
  <a
    rel="noreferrer noopener"
    href="https://github.com/buchen/portfolio"
    data-type="URL"
    data-id="https://github.com/buchen/portfolio"
    target="_blank"
    >открытым</a
  >
  исходным кодом), десктопная программа для учета инвестиций. Я выбрал именно
  её, потому что увидел ряд преимуществ в сравнении с другими решениями:
</p>

<ul>
  <li>
    Хранит данные на диске вашего компьютера. В отличие от
    <a href="{{ '/favourites/#investment-accounting' | relative-url }}"
      >онлайн-сервисов</a
    >
    для учета инвестиций, <strong>доступ к данным есть только у вас</strong>.
    Они хранятся в XML-файле, который, при желании, можно бэкапить в облако
    любым удобным способом.
  </li>
  <li>
    <strong>Открытость кода</strong> позволяет сообществу пользователей
    рассчитывать на отсутствие всевозможных закладок, майнеров, бэкдоров и
    проверять правильность расчётов.
  </li>
  <li>
    Написана на Java, а значит доступна для практически
    <strong>любой десктопной операционной системы</strong>.
  </li>
  <li>
    <strong>Легче, чем создавать свои таблицы</strong>, особенно когда речь
    заходит о расчете TWR (доходности, очищенной от влияния покупок и продаж),
    сплитах, отображения данных в разных валютах и выборе периодов для просмотра
    статистики.
  </li>
  <li>
    <strong>Данные сделок могут быть экспортированы</strong> в CSV или JSON, что
    оставляет возможность для дальнейших автоматизированных переездов в другой
    софт. Если умеете писать скрипты для конвертации файлов.
  </li>
  <li>Бесплатно!</li>
</ul>

<h2>Возможности</h2>

<figure>
  <figure>
    <a href="/assets/images/pp1.png" target="_blank" rel="noopener"
      ><img src="/assets/images/pp1.png"
    /></a>
  </figure>

  <figure>
    <a href="/assets/images/pp2.png" target="_blank" rel="noopener"
      ><img src="/assets/images/pp2.png"
    /></a>
  </figure>

  <figure>
    <a href="/assets/images/pp3.png" target="_blank" rel="noopener"
      ><img src="/assets/images/pp3.png"
    /></a>
  </figure>
  <figcaption>Скриншоты программы с официального сайта</figcaption>
</figure>

<ul>
  <li>
    Объединяет сделки по разным счетам в одном месте. Мало у кого всего один
    брокерский счет, из-за чего статистика в кабинетах отдельных брокеров
    бесполезна. Здесь весь зоопарк будет учтен в едином интерфейсе с
    объединенными результатами.
  </li>
  <li>
    Отображение структуры, результатов (TWR, IRR, волатильность, просадки и
    прочее) и динамики портфеля и отдельных активов в таблицах и на графиках,
    которые вы создаете сами как угодно. Состав колонок в таблицах можно менять
    под себя, а на графиках отображать не только портфель, но и отдельные
    активы, бенчмарки, курсы валют и инфляцию.
  </li>
  <li>
    Отображение статистики вашей активности — пополнений портфеля и торговли, в
    частности уплаченных комиссий, оборачиваемости, количества сделок, среднего
    времени удержания позиции и тому подобного.
  </li>
  <li>
    Учет любых комиссий по счетам в расчете доходностей — как привязанных к
    конкретным сделкам (вводятся вместе со сделками), так и удержанных по счетам
    в другое время.
  </li>
  <li>Учет налогов и налоговых вычетов.</li>
  <li>
    Учет процентных платежей по денежным счетам, в том числе отрицательных и
    облагаемых налогом.
  </li>
  <li>
    Знает курсы валют (даже с рублем, если настроить) и умеет показывать
    результаты портфеля в любой валюте.
  </li>
  <li>
    Учет переводов денег и ценных бумаг между счетами и конвертаций валюты.
  </li>
  <li>
    Учет дробления акций/паев (сплитов). Указываете дату и коэффициент
    дробления, дальше всё происходит само.
  </li>
  <li>
    Есть локализации интерфейса в разные языки, которые выбираются в настройках.
    Я пользуюсь английской версией, но есть и русская (качество локализации не
    проверял).
  </li>
</ul>

<p>
  Есть и возможность импорта данных из отчетов различных брокеров. Но поддержки
  российских брокеров нет, в основном немецких, так что сделки придется вбивать
  руками. Есть экспериментальный импорт из XML-отчета Interactive Brokers (через
  Activity Flex Query), но я не разбирался как им пользоваться (и не нашел
  внятных инструкций на сайте PP).
</p>

<p>
  Также стоит отметить, что в левом меню есть полезная секция таксономий. У меня
  их две: классы активов (equity, debt, cash, real) и размещение активов (asset
  location — Russia, US, KZ). Денежные счета я добавляю в cash и соответствующую
  страну брокера, активы — в свой класс активов и страну, где они хранятся.
  Программа сама посчитает сколько процентов активов к какому элементу
  таксономии относится и покажет распределение в таблице или на графике, в том
  числе изменение весов во времени. Есть даже встроенный помощник для
  ребалансировки на основе таксономии, но, конечно,
  <a href="https://capital-gain.ru/app/rebalance">мой</a> круче.😉
</p>

<h2>Работа с программой</h2>

<p>
  Перечислю общий порядок действий, чтобы вы знали с чего лучше начать и чем
  закончить, потому что кнопочек и пунктиков меню тут много.
</p>

<p>
  Пополнения брокерских счетов (вами или, например, зачислением дивидендов) и
  вывод с них денег учитываются по денежным счетам в программе, а покупка и
  продажа ценных бумаг — по бумажным.
</p>

<p>
  Сперва лучше добавить денежные брокерские счета. У одного брокера их может
  быть несколько в разных валютах, если у вас есть конвертации. Можно добавить и
  банковские счета или депозиты, если вы хотите их здесь учитывать. После этого
  добавляете бумажные брокерские счета («депо») у тех же брокеров. По ним
  учитываются движения бумаг и остатки.
</p>

<p>
  Для ценных бумаг в левом меню лучше сразу создать несколько списков
  (watchlists), куда вы их будете помещать, чтобы не путаться. Например, у меня
  есть такие списки: Активы, Валюты и Бенчмарки (для сравнения с ними портфеля —
  фондовые индексы, фонды, которыми я не владею, ИПЦ).
</p>

<p>
  В секции ценных бумаг добавляете нужные валютные курсы через кнопку +, пункт
  New exchange rate. Российским инвесторам чаще всего, конечно, нужен USDRUB.
  Добавление валют и настройка автоматического получения котировок подробно
  описаны ниже.
</p>

<p>
  Дальше через ту же кнопку +, New instrument добавляете активы — те, что
  находятся в портфеле и те, за которыми хотите следить или сравнивать с ними
  результаты портфеля. Настройки описаны ниже.
</p>

<p>
  Заводите все свои пополнения счетов в конкретных валютах, конвертации (через
  подменю денежного счета Перевод), сделки с бумагами и комиссии, переводы денег
  и бумаг, зачисления выплат на счета от эмитентов и выводы денег. Всё это
  называется общим словом Транзакции. В этот момент у вас начнут рассчитываться
  результаты инвестирования, даже если вы не настроите обновление котировок,
  потому что программа знает цены сделок и считает последней ценой наиболее
  недавнюю.
</p>

<p>
  В секции отчеты есть много разной уже готовой информации — покликайте, там всё
  должно быть знакомо — динамика портфеля, результаты инвестирования, график
  доходности / волатильности, круговая (и не только) диаграмма долей активов. На
  экране Performance можно сделать несколько вкладок с разными наборами
  доступных виджетов статистики, в итоге получится персонализированный дашборд,
  отображающий текущее положение дел как вам удобно (или несколько разных). На
  экране Chart есть возможность построить несколько графиков с разными наборами
  активов.
</p>

<h2>Обновление котировок</h2>

<p>
  Переходим к самому интересному. Скажу сразу, сложность настройки
  автоматического сбора котировок из разных API или сайтов довольно высокая,
  кто-то даже может почувствовать себя программистом. Делать это не обязательно,
  данные можно вбивать вручную (например, раз в месяц), или же они в любом
  случае обновятся при добавлении транзакций, что не идеально, но посчитает вам
  доходность. Но с автообновлением котировок и красивыми графиками жить всё-таки
  лучше, веселее (особенно когда они падают на 60% за неделю).
</p>

<p>
  Далее я иногда буду упоминать какое-то «API» — если не знаете, что это, то и
  не надо. Можно считать, что это просто специальные ссылки на сайты, из которых
  одни программы могут получать какие-то данные из других программ, а вы только
  один раз им поможете найти друг друга, всё правильно настроив.
</p>

<p>
  Для всего зарубежного (ETF) можно использовать сервисы
  <a
    rel="noreferrer noopener"
    href="https://finance.yahoo.com/"
    data-type="URL"
    data-id="https://finance.yahoo.com/"
    target="_blank"
    >Yahoo Finance</a
  >
  или
  <a
    rel="noreferrer noopener"
    href="https://www.alphavantage.co/"
    data-type="URL"
    data-id="https://www.alphavantage.co/"
    target="_blank"
    >Alpha Vantage</a
  >. Первое делается вообще элементарно, а для второго нужно зарегистрироваться
  на их сайте, получить ключ от API и указать его в общих настройках Portfolio
  Performance. Котировки российских инструментов будем получать из API Мосбиржи
  и сайта InvestFunds — это посложнее.
</p>

<h3>Yahoo Finance</h3>

<p>
  Настроим забор данных для фонда Vanguard FTSE All-World UCITS ETF (Acc) под
  тикером VWRA на LSE. В Yahoo Finance его можно найти под тикером
  <a
    rel="noreferrer noopener"
    href="https://finance.yahoo.com/quote/VWRA.L/"
    data-type="URL"
    data-id="https://finance.yahoo.com/quote/VWRA.L/"
    target="_blank"
    >VWRA.L</a
  >, последняя буква после точки — это обозначение биржи. Жмем плюс в списке
  ценных бумаг и выбираем пункт New Instrument, далее по списку и скриншотам:
</p>

<ul>
  <li>
    Поиск по инструментам на Yahoo Finance встроен в саму программу. Если
    найдете там что нужно и выберете, это немного предзаполнит данные в
    следующих формах. Пользоваться поиском не обязательно, можно нажать кнопку
    Empty Instrument и вбить данные самостоятельно.
  </li>
  <li>
    Во вкладке Security Master Data не забудьте выбрать валюту, указать Symbol
    как на Yahoo Finance и выбрать правильный календарь биржи. Можете заполнить
    ISIN, чтобы работало открытие ссылки на justETF и другие сервисы в браузере
    (доступно в подменю Open in browser по клику правой кнопкой мыши на
    инструменте).
  </li>
  <li>
    История котировок во вкладке Historical Quotes найдется автоматически по
    указанному тикеру, когда выберете правильный источник (Yahoo Finance).
  </li>
  <li>
    В качестве источника для последней цены во вкладке Latest Quote тоже нужно
    выбрать Yahoo. Это позволит забирать изменения цены внутри дня, если вы
    зачем-то хотите их видеть.
  </li>
  <li>
    Во вкладке Additional Attributes можно указать, например, TER. Во вкладке
    Taxonomies — указать класс активов и любые другие категоризации, что вы себе
    создали.
  </li>
</ul>

<figure>
  <figure>
    <a
      href="/assets/images/PP-VWRA-lse-search.png"
      target="_blank"
      rel="noopener"
      ><img src="/assets/images/PP-VWRA-lse-search.png"
    /></a>
  </figure>

  <figure>
    <a href="/assets/images/PP-VWRA-general.png" target="_blank" rel="noopener"
      ><img src="/assets/images/PP-VWRA-general.png"
    /></a>
  </figure>

  <figure>
    <a href="/assets/images/PP-VWRA-history.png" target="_blank" rel="noopener"
      ><img src="/assets/images/PP-VWRA-history.png"
    /></a>
  </figure>

  <figure>
    <a href="/assets/images/PP-VWRA-latest.png" target="_blank" rel="noopener"
      ><img src="/assets/images/PP-VWRA-latest-1024x730.png"
    /></a>
  </figure>
</figure>

<h3>Alpha Vantage</h3>

<p>
  Чтобы у вас был запасной вариант в случае, если Yahoo по какой-то причине
  отвалится, проделаем всё то же самое, но с другим источником истории котировок
  — alphavantage.co:
</p>

<ul>
  <li>
    <a
      rel="noreferrer noopener"
      href="https://www.alphavantage.co/support/#api-key"
      data-type="URL"
      data-id="https://www.alphavantage.co/support/#api-key"
      target="_blank"
      >Получаем</a
    >
    свой API key (можно считать это паролем), который затем вставляем в
    настройки Portfolio Performance, чтобы приложение могло обращаться к их API.
  </li>
  <li>
    Как обычно, создаем новый инструмент. Поиск можно пропустить, здесь он нам
    ничем не поможет, и сразу нажать Empty Instrument.
  </li>
  <li>
    В поле Symbol указываем тот же тикер VWRA.L, потому что именование биржи на
    Alpha Vantage совпадает.
  </li>
  <li>
    В истории котировок выбираем источник Alpha Vantage, котировки загрузятся
    автоматически.
  </li>
  <li>
    Последнюю цену можно попытаться забирать с Alpha Vantage, но у меня это
    почему-то не работает, а можно выбрать Yahoo.
  </li>
</ul>

<figure>
  <figure>
    <a
      href="/assets/images/PP-alpha-vantage-settings.png"
      target="_blank"
      rel="noopener"
      ><img src="/assets/images/PP-alpha-vantage-settings.png"
    /></a>
  </figure>

  <figure>
    <a
      href="/assets/images/PP-VWRA-general-alpha.png"
      target="_blank"
      rel="noopener"
      ><img src="/assets/images/PP-VWRA-general-alpha.png"
    /></a>
  </figure>

  <figure>
    <a
      href="/assets/images/PP-VWRA-history-alpha.png"
      target="_blank"
      rel="noopener"
      ><img src="/assets/images/PP-VWRA-history-alpha.png"
    /></a>
  </figure>
</figure>

<h3>Паевые инвестиционные фонды</h3>

<p>
  В Portfolio Performance можно настроить импорт котировок или расчетных цен как
  биржевых фондов, так и любых других. Для биржевых цены можно брать с Мосбиржи,
  а для остальных с InvestFunds.
</p>

<h4>API Мосбиржи</h4>

<p>
  Для получения данных БПИФ можно использовать бесплатный (для личного
  использования) API Мосбиржи. Настройки здесь будут зависеть от типа
  инструмента, я покажу примеры с БПИФ SBMX.
</p>

<ul>
  <li>
    В качестве провайдера данных во вкладке Historical Quotes выбираем JSON. Это
    не сервис, а формат данных, который умеют отдавать почти все современные
    API, в том числе и Мосбиржи.
  </li>
  <li>
    В поле Feed URL скопируйте такую ссылку:
    <code
      >https://iss.moex.com/iss/history/engines/stock/markets/shares/boards/TQTF/securities/<strong>SBMX</strong>.json?history.columns=TRADEDATE,CLOSE,LOW,HIGH,VOLUME&amp;iss.meta=off&amp;limit=100&amp;from={DATE:yyyy-MM-01}</code
    >
    — в ней мы выбрали режим торгов под кодом TQTF на фондовом рынке (stock),
    где и торгуются БПИФы в рублях, а в параметрах отключили передачу лишней
    информации, настроили поля данных, которые хотим получать и подставили
    специальный шаблон выбора даты начала данных, чтобы Portfolio Performance
    мог воспользоваться пагинацией (навигацией по страницам данных), ведь на
    один запрос API Мосбиржи отдает максимум 100 строк, а дней в истории
    котировок больше.
  </li>
  <li>
    В поле Date Format указыаем yyyy-MM-dd, хотя здесь это не обязательно —
    программа поймет возвращаемую Мосбиржей дату и без указания формата.
  </li>
  <li>
    В поле Date Time Zone можете указать Europe/Moscow, но это не обязательно.
  </li>
  <li>
    В оставшихся полях указываем путь к интересующим нас данным в виде
    <code>$.history.data[*][0, 1, 2, 3 или 4]</code> (см. скриншот). Число в
    квадратных скобках — это индекс (номер, начинающийся с нуля) колонки,
    которую мы указали в ссылке (например, TRADEDATE у нас первая, её индекс 0).
  </li>
</ul>

<p>
  Аналогично настраивается получение текущей цены, только ссылка будет другой:
  <code
    >https://iss.moex.com/iss/engines/stock/markets/shares/boards/TQTF/securities/<strong>SBMX</strong>.json?iss.meta=off&amp;iss.only=marketdata&amp;marketdata.columns=SYSTIME,LAST,LOW,HIGH,VOLTODAY</code
  >. Доступ к данным здесь будет по такому пути:
  <code>$.marketdata.data[*][0, 1, 2, 3 или 4]</code> (см. скриншот).
</p>

<figure>
  <figure>
    <a
      href="/assets/images/sbmx-historical-quotes.png"
      target="_blank"
      rel="noopener"
      ><img src="/assets/images/sbmx-historical-quotes.png"
    /></a>
  </figure>

  <figure>
    <a
      href="/assets/images/sbmx-latest-quote.png"
      target="_blank"
      rel="noopener"
      ><img src="/assets/images/sbmx-latest-quote.png"
    /></a>
  </figure>

  <figcaption>
    Low, high и volume указывать не обязательно, но для каких-то текущих или
    будущих функций программы они могут пригодится (например, графиков или
    индикаторов).
  </figcaption>
</figure>

<p>
  Никто не запрещает нам вместо биржевых цен импортировать по фондам iNAV с
  Мосбиржи (внутридневные расчетные цены). Для этого в качестве Feed URL можно
  использовать следующие ссылки, на примере БПИФ EQMX (iNAV-тикеры можно
  посмотреть
  <a href="https://www.moex.com/ru/index/inav">здесь</a>, они все из 5–6 букв):
</p>

<ul>
  <li>
    Получение истории котировок:
    <code
      >https://iss.moex.com/iss/history/engines/stock/markets/index/securities/<strong>EQMXE</strong>.json?history.columns=TRADEDATE,CLOSE,LOW,HIGH,VOLUME&amp;iss.meta=off&amp;limit=100&amp;from={DATE:yyyy-MM-01}</code
    >
  </li>
  <li>
    Получение последней цены:
    <code
      >https://iss.moex.com/iss/engines/stock/markets/index/securities/<strong>EQMXE</strong>.json?iss.meta=off&amp;iss.only=marketdata&amp;marketdata.columns=TRADEDATE,CURRENTVALUE,LOW,HIGH,VOLTODAY</code
    >
  </li>
</ul>

<p>
  Кроме фондов с Мосбиржи можно получить данные и по другим инструментам.
  Например, по акциям на примере Лукойл (режим торгов TQBR, тикер LKOH):
</p>

<ul>
  <li>
    Получение истории котировок:
    <code
      >https://iss.moex.com/iss/history/engines/stock/markets/shares/boards/TQBR/securities/<strong>LKOH</strong>.json?history.columns=TRADEDATE,CLOSE,LOW,HIGH,VOLUME&amp;iss.meta=off&amp;limit=100&amp;from={DATE:yyyy-MM-01}</code
    >
  </li>
  <li>
    Получение последней цены:
    <code
      >https://iss.moex.com/iss/engines/stock/markets/shares/boards/TQBR/securities/<strong>LKOH</strong>.json?iss.meta=off&amp;iss.only=marketdata&amp;marketdata.columns=SYSTIME,LAST,LOW,HIGH,VOLTODAY</code
    >
  </li>
</ul>

<h4>InvestFunds</h4>

<p>
  Получить данные по любым ПИФ можно с
  <a href="https://investfunds.ru/">investfunds.ru</a>. Официального API у них
  нет, но есть возможность получить данные через HTTP-запрос с JSON-ответом,
  который используется у них на сайте для отображения графика истории цен пая.
  Сделаем это на примере открытого фонда акций Арсагеры. Открываем
  <a href="https://investfunds.ru/funds/403/">страницу фонда</a> и в адресной
  строке браузера ищем число, это и есть ID:
</p>

<figure>
  <a href="/assets/images/SCR-20250816-ieqk.png" target="_blank" rel="noopener"
    ><img src="/assets/images/SCR-20250816-ieqk.png" width="320"
  /></a>

  <figcaption>403 — то, что мы ищем.</figcaption>
</figure>

<p>Дальше можно настраивать Portfolio Performance, как обычно:</p>

<ul>
  <li>Создаем новый инструмент через пункт меню New instrument.</li>
  <li>
    В качестве провайдера данных во вкладке Historical Quotes выбираем JSON.
  </li>
  <li>
    В поле Feed URL скопируйте такую ссылку:
    <code
      >https://investfunds.ru/funds/<strong>403</strong>/?action=chartData&data_key=pay&date_from={DATE:01.MM.yyyy}&currencyId=1&ids%5B%5D=<strong
        >403</strong
      ></code
    >
    — не забудьте поменять ID на правильный.
  </li>
  <li>
    Поле Date Format можно не заполнять, даты там представлены числом
    миллисекунд с 1 января 1970 года (unix timestamp) — Portfolio Performane
    поймет их автоматически.
  </li>
  <li>
    В поле Date Time Zone можете указать Europe/Moscow, но это не обязательно.
  </li>
  <li>
    В оставшихся полях указываем путь к интересующим нас данным в виде
    <code>$[0].data[*][0 или 1]</code> (см. скриншот). 0 в квадратных скобках
    здесь — это дата, 1 — расчетная цена пая (закрытия).
  </li>
</ul>

<p>
  Расчетные цены паев открытых ПИФ рассчитываются на конец дня и становятся
  известны только на следующий рабочий день, поэтому взять текущую цену (для
  вкладки Latest Quote) с InvestFunds или откуда-то ещё не получится, её просто
  не существует. Расчетные цены закрытых ПИФ, как правило, публикуются раз в
  неделю, месяц или ещё реже.
</p>

<p>
  Однако если фонд торгуется на бирже, мы можем взять текущую цену пая оттуда,
  таким образом получив котировку за сегодня. Для этого в Feed URL следует
  указать ссылку
  <code
    >https://iss.moex.com/iss/engines/stock/markets/shares/boards/TQIF/securities/<strong>RU000A0HGNG6</strong>.json?iss.meta=off&iss.only=marketdata&marketdata.columns=SYSTIME,LAST,LOW,HIGH,VOLTODAY</code
  >, а остальные настройки будут аналогичны БПИФ. ISIN фонда замените на тот,
  что указан на его
  <a href="https://www.moex.com/ru/issue.aspx?board=TQIF&code=RU000A0HGNG6"
    >странице на бирже</a
  >.
</p>

<figure>
  <figure>
    <a
      href="/assets/images/investfunds-historical-quotes.png"
      target="_blank"
      rel="noopener"
      ><img src="/assets/images/investfunds-historical-quotes.png"
    /></a>
  </figure>

  <figure>
    <a
      href="/assets/images/investfunds-latest-quote.png"
      target="_blank"
      rel="noopener"
      ><img src="/assets/images/investfunds-latest-quote.png"
    /></a>
  </figure>
</figure>

<p>
  По торгующимся ПИФ вместо InvestFunds историю котировок можно получать и с
  Мосбиржи. Тем же способом, что мы разобрали выше для БПИФ, только режим торгов
  в ссылке будет
  <strong>TQIF</strong>, а вместо тикера — ISIN фонда. Но это будут не расчетные
  цены пая, а биржевые.
</p>

<h3>Обменные курсы и рынок драгоценных металлов</h3>

<p>
  Portfolio Performance собирает курсы множества валют к евро с сайта ЕЦБ, но
  EURRUB перестал там публиковаться в марте 2022, а USDRUB никогда и не было. До
  ввода санкций против Мосбиржи курс валютных пар с участием рубля можно было
  забирать с Мосбиржи, но затем торги долларами и евро там прекратились, поэтому
  их я теперь предлагаю забирать с моего сайта, куда они поступают из XML API ЦБ
  (к сожалению, Portfolio Performance не поддерживает XML, только JSON, а ЦБ до
  сих пор не сделал JSON API для курсов валют).
</p>

<h4>API Мосбиржи</h4>

<ul>
  <li>
    В списке бумаг кликаете плюс и выбираете <strong>New exchange rate</strong>.
  </li>
  <li>В первой вкладке заполняете коды валют в правильном порядке.</li>
  <li>
    На вкладке с историей всё то же самое, что и с БПИФ выше, но ссылка будет
    другая:
    <code
      >https://iss.moex.com/iss/history/engines/currency/markets/selt/boards/CETS/securities/<strong>CNYRUB_TOM</strong>.json?history.columns=TRADEDATE,CLOSE,LOW,HIGH,VOLRUR&amp;iss.meta=off&amp;limit=100&amp;from={DATE:yyyy-MM-01}</code
    >. Коды других валютных пар ищите
    <a href="https://www.moex.com/ru/markets/currency/">на странице Мосбирже</a
    >.
  </li>
  <li>
    Ссылка для получения последней цены выглядит так:
    <code
      >https://iss.moex.com/iss/engines/currency/markets/selt/boards/CETS/securities/<strong>CNYRUB_TOM</strong>.json?iss.meta=off&amp;iss.only=marketdata&amp;marketdata.columns=SYSTIME,LAST,LOW,HIGH,VOLTODAY</code
    >
  </li>
</ul>

<figure>
  <figure>
    <a
      href="/assets/images/cnyrub-master-data.png"
      target="_blank"
      rel="noopener"
      ><img src="/assets/images/cnyrub-master-data.png"
    /></a>
  </figure>

  <figure>
    <a
      href="/assets/images/cnyrub-historical-quotes.png"
      target="_blank"
      rel="noopener"
      ><img src="/assets/images/cnyrub-historical-quotes.png"
    /></a>
  </figure>

  <figure>
    <a
      href="/assets/images/cnyrub-latest-quote.png"
      target="_blank"
      rel="noopener"
      ><img src="/assets/images/cnyrub-latest-quote.png"
    /></a>
  </figure>
</figure>

<p>
  Обновление котировок драгоценных металлов на Мосбирже настраивается так же,
  как и для валют, потому что они торгуются на валютном рынке. Только добавлять
  их в программу надо через пункт меню New instrument. В качестве тикера
  используйте GLDRUB_TOM, SLVRUB_TOM, PLTRUB_TOM или PLDRUB_TOM.
</p>

<h4>Capital-Gain.ru</h4>

<p>Инструкция для добавления внебиржевых курсов доллара и евро к рублю:</p>

<ul>
  <li>
    В списке бумаг кликаете плюс и выбираете <strong>New exchange rate</strong>.
  </li>
  <li>
    В первой вкладке заполняете коды валют в правильном порядке. На скриншоте
    ниже Symbol указан USDRUB=X — это формат Yahoo Finance, откуда будем
    получать последнюю цену (latest quote), потому что на моем сайте её нет.
  </li>
  <li>
    На вкладке с историей Feed URL будет следующий:
    <code>https://capital-gain.ru/data/<strong>USDRUB</strong>.json</code>. Для
    евро укажите <strong>EURRUB</strong>.
    <ul>
      <li>В поле Path to Date укажите <code>$.[*].date</code></li>
      <li>Date Format: <code>yyyy-MM-dd</code></li>
      <li>Path to Close: <code>$.[*].close</code></li>
      <li>Данных по low, high ценам и объемам нет.</li>
    </ul>
  </li>
  <li>
    Для получения последней цены выберите во вкладке Latest Quote пункт Yahoo
    Finance. Откуда они берут курс и насколько он соответствует межбанковскому
    курсу, который использует ЦБ, я не знаю, но если вам нужен intraday курс, то
    это вариант его получить.
  </li>
</ul>

<figure>
  <figure>
    <a
      href="/assets/images/usdrub-master-data.png"
      target="_blank"
      rel="noopener"
      ><img src="/assets/images/usdrub-master-data.png"
    /></a>
  </figure>

  <figure>
    <a
      href="/assets/images/usdrub-historical-quotes.png"
      target="_blank"
      rel="noopener"
      ><img src="/assets/images/usdrub-historical-quotes.png"
    /></a>
  </figure>

  <figure>
    <a
      href="/assets/images/usdrub-latest-quote.png"
      target="_blank"
      rel="noopener"
      ><img src="/assets/images/usdrub-latest-quote.png"
    /></a>
  </figure>
</figure>

<p>
  PP собирает курсы множества валют к евро, поэтому при наличия курса евро к
  вашей валюте, выбранной основной в программе, может привести стоимость активов
  практически в любых валютах к ней через кросс-курсы.
</p>

<h3>Фондовые индексы</h3>

<p>
  Зарубежные индексы можно брать с Yahoo Finance, правда,
  <a
    rel="noreferrer noopener"
    href="https://finance.yahoo.com/world-indices"
    data-type="URL"
    data-id="https://finance.yahoo.com/world-indices"
    target="_blank"
    >ассортимент</a
  >
  там ограничен ценовыми страновыми индексами (S&amp;P 500, FTSE 100, DAX, CAC
  40 и т. д.), а из индексов полной доходности есть разве что
  <a
    rel="noreferrer noopener"
    href="https://finance.yahoo.com/quote/%5ESP500TR/"
    data-type="URL"
    data-id="https://finance.yahoo.com/quote/%5ESP500TR/"
    target="_blank"
    >^SP500TR</a
  >
  (у остальных от S&amp;P с полной доходностью вроде бы нет истории, а
  мультистрановых индексов от MSCI или FTSE там вообще нет). Если они вам нужны,
  вместо индекса полной доходности можно найти ирландский ETF, реинвестирующий
  дивиденды, на этот или похожий индекс. И не забывайте выбирать правильную
  валюту при добавлении индексов.
</p>

<p>
  Данные российских бенчмарков можно забирать с Мосбиржи. Настраивается всё
  точно так же, как для БПИФ, отличие будет только в ссылке на API Мосбиржи.
  Например, для индекса российских акций MCFTR:
</p>

<ul>
  <li>
    Получение истории котировок:
    <code
      >https://iss.moex.com/iss/history/engines/stock/markets/index/securities/<strong>MCFTR</strong>.json?history.columns=TRADEDATE,CLOSE,LOW,HIGH,VOLUME&amp;iss.meta=off&amp;limit=100&amp;from={DATE:yyyy-MM-01}</code
    >
  </li>
  <li>
    Получение последней цены:
    <code
      >https://iss.moex.com/iss/engines/stock/markets/index/securities/<strong>MCFTR</strong>.json?iss.meta=off&amp;iss.only=marketdata&amp;marketdata.columns=TRADEDATE,CURRENTVALUE,LOW,HIGH,VOLTODAY</code
    >
  </li>
</ul>

<figure>
  <a
    href="/assets/images/Performance_Chart_World_View.png"
    target="_blank"
    rel="noopener"
    ><img
      src="/assets/images/Performance_Chart_World_View-1024x600.png"
      style="max-width: 800px"
  /></a>
  <figcaption>
    Доходность фондовых индексов разных стран с начала 2022 года в долларах США
    (без дивидендов).<br />В программе график кликабельный — открывается тултип
    с доходностями с начала периода до места, куда вы нажали. Кроме выбора
    периода есть и выбор интервала отображения — день, неделя, месяц или год.
  </figcaption>
</figure>

<h2>Учет облигаций</h2>

<p>
  Слабое место Portfolio Performance — непонимание программой облигаций. Здесь
  просто нет такого понятия. Программа заточена под ETF, и, поскольку любой ETF
  — это акция, то её легко использовать и для отдельных акций, если вам это
  нужно (дивиденды, сплиты — всё поддерживается).
</p>

<p>
  Но вот про облигации, у которых номинал и текущие цены живут отдельной жизнью,
  тут нет ничего. Поэтому их котировки остается периодически считать в деньгах и
  обновлять вручную. Делается это не сложно (может, даже проще, чем в таблицах),
  то есть недостаток именно в отсутствии прямой возможности это автоматизировать
  (если вы, конечно, не напишите какой-нибудь веб-сервис, который будет делать
  это автоматически и отдавать данные, пригодные для импорта в Portfolio
  Performance).
</p>

<p>
  Текущих цен у облигаций две — с НКД (грязная) и без (чистая), и нам логично
  учитывать грязную, то есть с добавленным НКД, потому что именно за неё мы
  можем облигацию продать. В момент выплаты купона НКД заменится на зачисленные
  на счет деньги, а цена облигации упадет на сумму выплаты.
</p>

<p>
  Для расчета грязной цены в деньгах берем текущий размер номинала облигации и
  умножаем на её цену в процентах с биржи, прибавляем НКД (тоже публикуется на
  бирже). Результат можно использовать как очередную котировку, которую можно
  добавить в программу вручную на экране списка ценных бумаг (вкладка Historical
  Quotes, правый клик, пункт меню Add), а сумму купона в день его выплаты можно
  учесть как дивиденд — это такое же зачисление денег на счет.
</p>

<figure>
  <a href="/assets/images/SU52002RMFS1.png" target="_blank" rel="noopener"
    ><img
      src="/assets/images/SU52002RMFS1-300x296.png"
      style="max-width: 300px"
  /></a>
  <figcaption>
    На примере
    <a
      rel="noreferrer noopener"
      href="https://www.moex.com/ru/issue.aspx?board=TQOB&amp;code=SU52002RMFS1"
      target="_blank"
      >ОФЗ-ИН 52002</a
    >
    все данные можно найти на сайте Мосбиржи.<br />Нам нужны три подчеркнутых
    числа (кликабельно).<br />Грязная цена этой облигации на 29.07.22 = 1364.21
    * 95.61% + 16.19 = 1320.51 руб.
  </figcaption>
</figure>

<h2>Инфляция</h2>

<p>
  В Portfolio Performance есть встроенная возможность забирать данные страновых
  ИПЦ с сайта ЕЦБ, причем среди стран там не только относящиеся к Евросоюзу. Но
  среди них нет России, да и имеющиеся данные не всегда последние (например, по
  США в июле были только апрельские), поэтому тут придется импровизировать.
</p>

<p>
  Чтобы добавить динамику ИПЦ Росстата, нужен какой-нибудь подходящий источник
  данных, который бы отдавал рост инфляции именно в виде индекса, то есть
  увеличивая предыдущее своё значение на последний прирост цен. Если вы знаете
  такой источник, напишите в комментах, лишним не будет.
</p>

<p>
  Я не знаю, поэтому для себя и вас сделал свой API (<mark>тот самый бонус</mark
  >) — автоматически обновляемый ряд значений
  <a
    rel="noreferrer noopener"
    href="https://rosstat.gov.ru/price"
    data-type="URL"
    data-id="https://rosstat.gov.ru/price"
    target="_blank"
    >индекса потребительских цен Росстата</a
  >
  накопленным итогом:
</p>

<figure>
  <a href="/assets/images/cpi-ru-settings.png" target="_blank" rel="noopener"
    ><img src="/assets/images/cpi-ru-settings-1024x745.png"
  /></a>
</figure>

<ul>
  <li>Формат: JSON</li>
  <li>
    URL:
    <a
      href="https://capital-gain.ru/data/CPI_RU.json"
      target="_blank"
      rel="noreferrer noopener"
      >https://capital-gain.ru/data/CPI_RU.json</a
    >
  </li>
  <li>Дата: <code>[*].date</code></li>
  <li>Цена закрытия: <code>[*].close</code></li>
</ul>

<p>
  Данные начинаются в январе 1991 года с 1 рубля, который каждый месяц
  индексируется на инфляцию. К июню 2022 года рублей стало уже 131 262. Ну а
  дальше эти данные можно использовать как бенчмарк своего портфеля или просто
  делать всякие визуализации для понимания ситуации.
</p>
<p>
  То же самое есть и для US CPI (индекс инфляции в США), его данные с 1913 года
  можно получить по ссылке:
  <a
    href="https://capital-gain.ru/data/CPI_US.json"
    target="_blank"
    rel="noreferrer noopener"
    >https://capital-gain.ru/data/CPI_US.json</a
  >
</p>

<p>
  На этом всё. Если я что-то забыл или остались непонятные моменты, пишите
  вопросы в комментариях!
</p>
